# Cluster Proxy Configuration - Extra Arguments for Proxy
- op: add
  path: /cluster/proxy/extraArgs
  value:
    "metrics-bind-address": "0.0.0.0:10249"  # Exposes proxy metrics on the specified address

# Cluster Controller Manager Configuration - Extra Arguments for Controller Manager
- op: add
  path: /cluster/controllerManager/extraArgs
  value:
    "bind-address": "0.0.0.0"  # Allows the controller manager to listen on all network interfaces

# Cluster Scheduler Configuration - Extra Arguments for Scheduler
- op: add
  path: /cluster/scheduler/extraArgs
  value:
    "bind-address": "0.0.0.0"  # Allows the scheduler to listen on all network interfaces

# Cluster API Server Configuration - Admission Control Settings
- op: replace
  path: /cluster/apiServer/admissionControl
  value:
    - name: PodSecurity
      configuration:
        apiVersion: pod-security.admission.config.k8s.io/v1alpha1
        defaults:
          audit: restricted  # Pod security policies for auditing
          audit-version: latest
          enforce: baseline  # Enforce baseline pod security standards
          enforce-version: latest
          warn: restricted  # Issue warnings for restricted pod security policies
          warn-version: latest
        exemptions:
          namespaces:
            # List of namespaces that are exempt from pod security controls
            - kube-system
            - metallb
            - metallb-config
            - topolvm-system
            - longhorn-system
            - kyverno
            - system-upgrade
            - openebs
            - snapshot-controller
            - volsync
            - flux-system
          runtimeClasses: []  # List of runtime classes that are exempt (empty by default)
          usernames: []  # List of usernames that are exempt (empty by default)
        kind: PodSecurityConfiguration  # Defines the configuration for PodSecurity admission controller

# Machine Features - Enabling Kubernetes Talos API Access
- op: add
  path: /machine/features/kubernetesTalosAPIAccess
  value:
    enabled: true  # Enables Kubernetes API access via Talos
    allowedRoles:
      - os:admin  # Allowed roles for API access
    allowedKubernetesNamespaces:
      - system-upgrade  # Allowed Kubernetes namespaces for API access (e.g., system-upgrade)
